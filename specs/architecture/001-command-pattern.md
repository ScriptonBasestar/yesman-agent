# ADR-001: Command Pattern 채택

## 상태

승인됨

## 날짜

2025-07-17

## 컨텍스트

기존 Yesman Claude 프로젝트의 명령어들이 개별 함수로 구현되어 있어 다음과 같은 문제점들이 발생했습니다:

1. **일관성 부족**: 각 명령어마다 다른 에러 처리 방식
1. **코드 중복**: 공통 기능(로깅, 설정 로딩, tmux 관리)이 반복 구현
1. **테스트 어려움**: 의존성 주입이 어려워 단위 테스트 작성이 복잡
1. **유지보수성**: 새로운 명령어 추가 시 표준화된 방식 부재

## 결정

**BaseCommand 패턴**을 도입하여 모든 명령어를 표준화합니다.

### 핵심 설계 원칙

1. **추상 기본 클래스**: 모든 명령어는 `BaseCommand`를 상속
1. **의존성 주입**: 생성자를 통한 서비스 주입 지원
1. **표준화된 실행 흐름**: `run()` → `validate_preconditions()` → `execute()`
1. **믹스인 패턴**: 공통 기능을 재사용 가능한 믹스인으로 분리

### 구현 구조

```python
class BaseCommand(ABC):
    def __init__(self, config=None, tmux_manager=None, claude_manager=None):
        # 의존성 주입 또는 DI 컨테이너에서 해결
        
    def run(self, **kwargs) -> Any:
        # 표준화된 실행 흐름과 에러 처리
        
    @abstractmethod
    def execute(self, **kwargs) -> Any:
        # 실제 명령어 로직 (하위 클래스에서 구현)
        
    def validate_preconditions(self) -> None:
        # 공통 검증 로직
```

### 믹스인 클래스들

- **SessionCommandMixin**: 세션 관련 공통 기능
- **ConfigCommandMixin**: 설정 관련 공통 기능
- **OutputFormatterMixin**: 출력 포맷팅 공통 기능

## 대안 검토

### 1. 함수 기반 접근 (현재 방식)

- **장점**: 단순함, 빠른 구현
- **단점**: 코드 중복, 일관성 부족, 테스트 어려움

### 2. 서비스 레이어 패턴

- **장점**: 비즈니스 로직 분리
- **단점**: 과도한 추상화, CLI 특성상 불필요한 복잡성

### 3. 플러그인 아키텍처

- **장점**: 확장성
- **단점**: 과도한 복잡성, 현재 규모에 부적합

## 결과

### 긍정적 영향

1. **일관성**: 모든 명령어가 동일한 패턴 사용
1. **재사용성**: 공통 기능을 믹스인으로 분리하여 재사용
1. **테스트 용이성**: 의존성 주입으로 단위 테스트 작성 용이
1. **유지보수성**: 새로운 명령어 추가 시 표준화된 방식 제공

### 부정적 영향

1. **초기 작업**: 기존 명령어들의 마이그레이션 필요
1. **복잡성**: 단순한 명령어도 클래스 구조 필요
1. **학습 곡선**: 새로운 개발자가 패턴을 이해해야 함

### 마이그레이션 전략

1. **단계적 마이그레이션**: 명령어별로 순차적 전환
1. **하위 호환성**: 기존 CLI 인터페이스 유지
1. **테스트 우선**: 각 명령어 마이그레이션 후 테스트 추가

## 구현 상태

- ✅ BaseCommand 구현 완료
- ✅ 믹스인 클래스들 구현 완료
- ✅ 12개 명령어 마이그레이션 완료
- ⏳ multi_agent.py 마이그레이션 보류 (복잡성으로 인해)

## 관련 ADR

- [ADR-002: 의존성 주입](./002-dependency-injection.md)
- [ADR-004: 에러 처리 표준화](../done/phase-3-004-standardize-error-handling__DONE_20250717.md)
